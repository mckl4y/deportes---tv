<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Amantes del FutbOl | TV & Sports</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700;900&family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { --bg: #050505; --card: #121212; --accent: #f8ff13; --text: #ffffff; --border: #222; }
        * { box-sizing: border-box; outline: none; }
        body { margin: 0; font-family: 'Roboto', sans-serif; background-color: var(--bg); color: var(--text); padding-top: 130px; }

        /* HEADER */
        .fixed-header { position: fixed; top: 0; width: 100%; z-index: 1000; background: #000; border-bottom: 2px solid var(--accent); }
        nav { height: 65px; display: flex; align-items: center; padding: 0 20px; justify-content: space-between; }
        .logo-container { display: flex; align-items: center; font-family: 'Orbitron', sans-serif; font-size: 20px; font-weight: 900; }
        .ball-o { width: 20px; height: 20px; background: #fff; border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; margin: 0 3px; position: relative; box-shadow: 0 0 8px var(--accent); }
        .ball-o::after { content: 'âš½'; font-size: 15px; position: absolute; }

        .search-container { padding: 10px 20px; background: #111; display: flex; gap: 10px; justify-content: center; }
        #main-search { width: 100%; max-width: 500px; background: #000; border: 1px solid #333; padding: 12px; color: white; border-radius: 4px; }
        .refresh-btn { background: var(--accent); border: none; padding: 0 15px; border-radius: 4px; font-weight: 900; cursor: pointer; }

        .nav-links { display: flex; gap: 15px; }
        .nav-btn { background: none; border: none; color: #666; font-weight: 700; cursor: pointer; text-transform: uppercase; font-size: 13px; padding: 10px 5px; border-bottom: 3px solid transparent; }
        .nav-btn.active { color: var(--accent); border-bottom: 3px solid var(--accent); }

        .container { max-width: 1000px; margin: 0 auto; padding: 20px; }
        
        /* EVENTOS */
        .category-header { background: #1a1a1a; padding: 12px; margin: 25px 0 10px; border-left: 4px solid var(--accent); font-weight: 900; color: var(--accent); text-transform: uppercase; }
        .event-card { display: grid; grid-template-columns: 80px 1fr; gap: 15px; background: var(--card); margin-bottom: 8px; padding: 15px; border-radius: 4px; border: 1px solid var(--border); }
        .event-time { text-align: center; font-weight: 900; font-size: 13px; color: #fff; }
        .event-teams { font-size: 16px; font-weight: 700; margin-bottom: 10px; color: var(--text); }
        .multi-link-select { width: 100%; background: #000; color: #22c55e; border: 1px solid #22c55e; padding: 10px; border-radius: 4px; font-weight: bold; cursor: pointer; }

        /* CANALES */
        .country-block { margin-bottom: 30px; }
        .country-name { font-size: 16px; font-weight: 900; margin-bottom: 12px; padding-bottom: 5px; border-bottom: 1px solid #333; color: #aaa; }
        .channels-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(130px, 1fr)); gap: 10px; }
        .channel-item { background: var(--card); padding: 12px; border-radius: 6px; text-align: center; border: 1px solid var(--border); cursor: pointer; transition: 0.2s; }
        .channel-item:hover { border-color: var(--accent); transform: scale(1.02); }
        .channel-item img { height: 35px; max-width: 90%; object-fit: contain; margin-bottom: 8px; filter: drop-shadow(0 0 5px rgba(0,0,0,0.5)); }
        .channel-item span { font-size: 10px; font-weight: bold; display: block; color: #eee; }

        /* PLAYER */
        #player-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 5000; display: none; flex-direction: column; }
        .player-bar { padding: 15px; background: #000; display: flex; justify-content: space-between; align-items: center; }
        iframe { flex-grow: 1; border: none; }

        .hidden { display: none; }
        .status-msg { text-align: center; padding: 40px; color: #666; font-weight: bold; }
    </style>
</head>
<body>

<div class="fixed-header">
    <nav>
        <div class="logo-container">AMANTES DEL FUTB<div class="ball-o"></div>L</div>
        <div class="nav-links">
            <button id="btn-events" class="nav-btn active" onclick="switchTab('events')">EVENTOS</button>
            <button id="btn-channels" class="nav-btn" onclick="switchTab('channels')">CANALES TV</button>
        </div>
    </nav>
    <div class="search-container">
        <input type="text" id="main-search" placeholder="Busca equipo, liga o paÃ­s..." onkeyup="filterAll()">
        <button class="refresh-btn" onclick="init()">RECARGAR â†»</button>
    </div>
</div>

<div class="container">
    <div id="section-events">
        <div id="events-status" class="status-msg">CONECTANDO CON LA PARRILLA...</div>
        <div id="events-content"></div>
    </div>
    <div id="section-channels" class="hidden">
        <div id="channels-status" class="status-msg">CARGANDO LISTA INTERNACIONAL...</div>
        <div id="channels-content"></div>
    </div>
</div>

<div id="player-overlay">
    <div class="player-bar">
        <span id="playing-now" style="font-weight:900; color:var(--accent);"></span>
        <button onclick="closePlayer()" style="background:var(--accent); border:none; padding:10px 20px; font-weight:900; cursor:pointer;">CERRAR</button>
    </div>
    <iframe id="main-player" allowfullscreen sandbox="allow-scripts allow-same-origin allow-forms allow-popups"></iframe>
</div>

<script>
    let eventsData = [];
    let channelsData = [];

    // Usamos una lista de proxies por si uno falla
    const proxies = [
        "https://api.allorigins.win/raw?url=",
        "https://thingproxy.freeboard.io/fetch/",
        "https://corsproxy.io/?"
    ];

    async function fetchData(url) {
        // Intenta con el primer proxy, si falla pasa al siguiente
        for (let proxy of proxies) {
            try {
                const response = await fetch(proxy + encodeURIComponent(url + "?t=" + new Date().getTime()));
                if (response.ok) return await response.json();
            } catch (e) { continue; }
        }
        throw new Error("No se pudo conectar");
    }

    async function init() {
        document.getElementById('events-status').innerText = "ACTUALIZANDO EVENTOS...";
        document.getElementById('channels-status').innerText = "ACTUALIZANDO CANALES...";
        
        try {
            const dataE = await fetchData("https://api.cdn-live.tv/api/v1/events/sports/?user=cdnlivetv&plan=free");
            const sports = dataE['cdn-live-tv'];
            eventsData = [];
            for (let s in sports) {
                sports[s].forEach(ev => { ev.category = s; eventsData.push(ev); });
            }
            renderEvents(eventsData);
            document.getElementById('events-status').classList.add('hidden');

            const dataC = await fetchData("https://api.cdn-live.tv/api/v1/channels/?user=cdnlivetv&plan=free");
            channelsData = dataC.channels;
            renderChannels(channelsData);
            document.getElementById('channels-status').classList.add('hidden');

        } catch (err) {
            document.getElementById('events-status').innerText = "ERROR DE SEÃ‘AL. PULSA RECARGAR.";
        }
    }

    function renderEvents(list) {
        const out = document.getElementById('events-content');
        const grouped = {};
        list.forEach(e => {
            if(!grouped[e.category]) grouped[e.category] = [];
            grouped[e.category].push(e);
        });

        let html = '';
        for(let cat in grouped) {
            html += `<div class="category-header">ðŸ”¥ ${cat}</div>`;
            grouped[cat].forEach(ev => {
                let options = `<option value="">ðŸ“º SELECCIONAR SEÃ‘AL (${ev.channels.length})</option>`;
                ev.channels.forEach((c, i) => { options += `<option value="${c.url}">Link ${i+1}: ${c.channel_name}</option>`; });
                
                html += `
                <div class="event-card">
                    <div class="event-time">${ev.time}<br><small style="color:var(--accent)">${ev.status}</small></div>
                    <div>
                        <div style="font-size:10px; color:#555; font-weight:bold;">${ev.tournament}</div>
                        <div class="event-teams">${ev.homeTeam} vs ${ev.awayTeam
