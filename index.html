<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>amantes del futbOl | En Vivo</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@900&family=Roboto:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --dazn-black: #050505;
            --dazn-accent: #f8ff13; 
            --dazn-card: #151515;
        }

        * { box-sizing: border-box; }
        body { margin: 0; font-family: 'Roboto', sans-serif; background-color: var(--dazn-black); color: white; padding-top: 70px; }

        /* LOGO PROFESIONAL */
        .logo-container { display: flex; align-items: center; font-family: 'Orbitron', sans-serif; font-size: 20px; font-weight: 900; }
        .ball-o { width: 18px; height: 18px; background: white; border-radius: 50%; position: relative; margin-left: 2px; background: radial-gradient(circle at 30% 30%, #fff, #999); display: inline-block; }
        .ball-o::after { content: '⚽'; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 16px; }

        nav { background: #000; height: 70px; display: flex; align-items: center; padding: 0 30px; position: fixed; top: 0; width: 100%; z-index: 1000; border-bottom: 2px solid var(--dazn-accent); justify-content: space-between; }
        .nav-links { display: flex; gap: 20px; font-size: 12px; font-weight: 900; text-transform: uppercase; }
        .nav-links span { cursor: pointer; padding: 26px 0; border-bottom: 3px solid transparent; transition: 0.2s; }
        .nav-links span.active { color: var(--dazn-accent); border-bottom: 3px solid var(--dazn-accent); }

        .container { padding: 20px; max-width: 1200px; margin: 0 auto; }
        .section-title { font-size: 20px; font-weight: 900; margin: 25px 0 15px; border-left: 4px solid var(--dazn-accent); padding-left: 12px; }

        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 15px; }
        .card { background: var(--dazn-card); border-radius: 4px; border: 1px solid #222; overflow: hidden; }
        .card-body { padding: 15px; }
        
        /* SELECTOR MULTIENLACES */
        .multi-link-box { margin-top: 15px; }
        .multi-link-select { 
            width: 100%; background: #000; color: var(--dazn-accent); border: 1px solid var(--dazn-accent); 
            padding: 10px; font-weight: bold; cursor: pointer; font-size: 12px;
        }

        .schedule-item { 
            display: flex; align-items: center; background: #111; margin-bottom: 8px; padding: 15px; 
            border-left: 3px solid #333; justify-content: space-between;
        }
        .time-badge { color: var(--dazn-accent); font-weight: 900; width: 70px; }

        #player-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 5000; display: none; flex-direction: column; }
        iframe { flex-grow: 1; border: none; }
    </style>
</head>
<body>

<nav>
    <div class="logo-container"><span>amantes del futb</span><div class="ball-o"></div></div>
    <div class="nav-links">
        <span id="tab-hoy" class="active" onclick="cargarVista('hoy')">Eventos Hoy</span>
        <span id="tab-canales" onclick="cargarVista('canales')">Canales TV</span>
        <span id="tab-agenda" onclick="cargarVista('agenda')">Agenda del Día</span>
    </div>
</nav>

<div class="container" id="app"></div>

<div id="player-modal">
    <div style="padding:15px; display:flex; justify-content:space-between; background:#0a0a0a;">
        <span id="playing-title" style="font-size:12px; font-weight:900; color:var(--dazn-accent);"></span>
        <button onclick="cerrarPlayer()" style="background:var(--dazn-accent); border:none; padding:5px 15px; font-weight:900; cursor:pointer;">X CERRAR</button>
    </div>
    <iframe id="video-frame" sandbox="allow-scripts allow-same-origin" allowfullscreen></iframe>
</div>

<script>
    const API_EVENTOS = "https://api.cdn-live.tv/api/v1/events/sports/?user=cdnlivetv&plan=free";
    const API_CANALES = "https://api.cdn-live.tv/api/v1/channels/?user=cdnlivetv&plan=free";

    // Función para obtener la fecha de hoy en formato YYYY-MM-DD
    function getHoyStr() {
        return new Date().toISOString().split('T')[0];
    }

    async function cargarVista(vista) {
        document.querySelectorAll('.nav-links span').forEach(s => s.classList.remove('active'));
        document.getElementById(`tab-${vista}`).classList.add('active');
        const app = document.getElementById('app');
        app.innerHTML = "<p style='text-align:center;'>Actualizando programación...</p>";

        try {
            if (vista === 'hoy' || vista === 'agenda') {
                const res = await fetch(API_EVENTOS);
                const data = await res.json();
                const sports = data['cdn-live-tv'];
                const hoy = getHoyStr();

                // Filtrar solo eventos de HOY o FUTUROS
                const filtrarEventos = (lista) => {
                    return lista.filter(ev => ev.start.startsWith(hoy) || ev.status === 'live');
                };

                if (vista === 'hoy') renderHoy(sports, filtrarEventos);
                else renderAgenda(sports, filtrarEventos);

            } else {
                const res = await fetch(API_CANALES);
                const data = await res.json();
                renderCanales(data.channels);
            }
        } catch (e) { app.innerHTML = "Error al cargar los datos."; }
    }

    function renderHoy(sports, filtro) {
        let html = '';
        ['Soccer', 'NBA', 'NFL', 'NHL'].forEach(cat => {
            const listaFiltrada = filtro(sports[cat] || []);
            if (listaFiltrada.length > 0) {
                html += `<div class="section-title">${cat === 'Soccer' ? 'Fútbol' : cat}</div><div class="grid">`;
                listaFiltrada.forEach(ev => {
                    let options = `<option value="">-- MULTIENLACE DISPONIBLE --</option>`;
                    ev.channels.forEach(ch => {
                        options += `<option value="${ch.url}">${ch.channel_name}</option>`;
                    });

                    html += `
                    <div class="card">
                        <div class="card-body">
                            <div style="color:${ev.status === 'live' ? 'red' : 'var(--dazn-accent)'}; font-size:11px; font-weight:900;">
                                ${ev.status === 'live' ? '● EN VIVO' : 'HOY - ' + ev.time}
                            </div>
                            <div style="font-weight:900; margin:10px 0; font-size:15px;">${ev.homeTeam} vs ${ev.awayTeam}</div>
                            <div style="font-size:11px; color:#777;">${ev.tournament}</div>
                            <div class="multi-link-box">
                                <select class="multi-link-select" onchange="if(this.value) abrirPlayer(this.value, '${ev.homeTeam} vs ${ev.awayTeam}')">
                                    ${options}
                                </select>
                            </div>
                        </div>
                    </div>`;
                });
                html += `</div>`;
            }
        });
        document.getElementById('app').innerHTML = html || "<p>No hay más eventos programados para hoy.</p>";
    }

    function renderAgenda(sports, filtro) {
        let todos = [];
        ['Soccer', 'NBA', 'NFL', 'NHL'].forEach(cat => { todos = todos.concat(filtro(sports[cat] || [])); });
        todos.sort((a,b) => a.time.localeCompare(b.time));

        let html = '<div class="section-title">Tu Agenda de Hoy</div>';
        todos.forEach(ev => {
            html += `
            <div class="schedule-item">
                <div class="time-badge">${ev.time}</div>
                <div style="flex-grow:1; margin:0 15px;">
                    <div style="font-weight:900;">${ev.homeTeam} vs ${ev.awayTeam}</div>
                    <div style="font-size:11px; color:#555;">${ev.tournament}</div>
                </div>
                <button onclick="cargarVista('hoy')" style="background:var(--dazn-accent); border:none; padding:8px; font-weight:900; cursor:pointer; font-size:10px;">VER ENLACES</button>
            </div>`;
        });
        document.getElementById('app').innerHTML = html || "<p>Agenda vacía para lo que queda de día.</p>";
    }

    function renderCanales(channels) {
        // (Lógica de canales por países igual que antes, simplificada aquí)
        document.getElementById('app').innerHTML = "<div class='section-title'>Canales TV Disponibles</div><div class='grid'>" + 
            channels.map(ch => `<div class="card" onclick="abrirPlayer('${ch.url}', '${ch.name}')" style="text-align:center; padding:15px;">
                <img src="${ch.image}" style="height:50px; margin-bottom:10px;">
                <div style="font-size:12px; font-weight:900;">${ch.name}</div>
            </div>`).join('') + "</div>";
    }

    function abrirPlayer(url, title) {
        document.getElementById('playing-title').innerText = title.toUpperCase();
        document.getElementById('video-frame').src = url;
        document.getElementById('player-modal').style.display = 'flex';
        document.body.style.overflow = 'hidden';
    }

    function cerrarPlayer() {
        document.getElementById('player-modal').style.display = 'none';
        document.getElementById('video-frame').src = '';
        document.body.style.overflow = 'auto';
    }

    cargarVista('hoy');
</script>
</body>
</html>
