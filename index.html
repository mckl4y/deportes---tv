<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AMANTES DEL DEPORTE | Global Hub</title>
    <style>
        :root {
            --blue-espn: #061922; 
            --blue-accent: #3b82f6;
            --bg: #f0f2f5;
            --live: #ef4444;
        }

        body { font-family: 'Inter', sans-serif; background: var(--bg); margin: 0; padding-top: 130px; }
        
        header { 
            background: white; padding: 10px 30px; 
            display: flex; justify-content: space-between; align-items: center;
            border-bottom: 3px solid var(--blue-accent);
            position: fixed; top: 0; width: 100%; z-index: 2000; box-sizing: border-box;
        }

        .nav-bar {
            background: #1e293b; padding: 10px;
            position: fixed; top: 65px; width: 100%; z-index: 1900;
            display: flex; justify-content: center; gap: 10px;
        }

        select {
            padding: 8px 15px; border-radius: 5px; border: none; font-weight: bold; cursor: pointer;
        }

        .dona-btn { background: #22c55e; color: white; border: none; padding: 10px 20px; border-radius: 8px; font-weight: 800; cursor: pointer; }

        .container { max-width: 1100px; margin: 0 auto; padding: 20px; }

        .league-title {
            background: var(--blue-espn); color: white; padding: 15px;
            border-radius: 8px 8px 0 0; border-left: 6px solid var(--blue-accent);
            font-size: 18px; font-weight: bold;
        }

        .match-card {
            background: white; border-bottom: 1px solid #e5e7eb;
            padding: 15px 20px; display: grid; grid-template-columns: 120px 1fr 180px;
            align-items: center; cursor: pointer;
        }
        .match-card:hover { background: #f8fafc; }

        .time-status { font-size: 13px; font-weight: bold; }
        .live-tag { color: var(--live); animation: blink 1s infinite; }
        
        .teams-grid { display: grid; grid-template-columns: 1fr 80px 1fr; align-items: center; text-align: center; }
        .team { display: flex; align-items: center; gap: 10px; font-weight: 700; }
        .team.home { justify-content: flex-end; }
        .team img { width: 30px; height: 30px; object-fit: contain; }
        .score-box { background: #334155; color: white; padding: 4px; border-radius: 4px; font-size: 18px; }

        /* Modales */
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); display: none; z-index: 3000; overflow-y: auto; }
        .modal-content { background: white; max-width: 700px; margin: 40px auto; border-radius: 12px; padding: 25px; }
        
        #cine { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: black; z-index: 4000; display: none; flex-direction: column; }
        iframe { flex-grow: 1; border: none; }

        @keyframes blink { 50% { opacity: 0.2; } }
        @media (max-width: 800px) { .match-card { grid-template-columns: 1fr; text-align: center; } .teams-grid { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

<header>
    <div style="font-size: 22px; font-weight: 900;">AMANTES DEL <span style="color:var(--blue-accent)">DEPORTE</span></div>
    <button class="dona-btn" onclick="alert('Bizum: [Tu N√∫mero]\nPayPal: [Tu Email]')">‚ù§Ô∏è DONA A AGUS</button>
</header>

<div class="nav-bar">
    <select id="sport-selector" onchange="cambiarDeporte()">
        <option value="soccer">‚öΩ F√∫tbol</option>
        <option value="basketball">üèÄ Baloncesto</option>
        <option value="tennis">üéæ Tenis</option>
        <option value="football">üèà NFL / F√∫tbol Amer.</option>
        <option value="baseball">‚öæ B√©isbol MLB</option>
        <option value="hockey">üèí Hockey NHL</option>
    </select>
    <select id="league-selector" onchange="cargarLiga()">
        </select>
</div>

<div class="container" id="master-list">
    <div style="text-align:center; padding:50px;">Selecciona una liga para ver la programaci√≥n completa de hoy.</div>
</div>

<div id="detail-modal" class="modal">
    <div class="modal-content" id="modal-body"></div>
</div>

<div id="cine">
    <div style="background:#111; padding:15px; display:flex; justify-content:space-between; color:white;">
        <button onclick="cerrarCine()" style="background:red; border:none; color:white; padding:8px 20px; cursor:pointer;">CERRAR</button>
        <span id="canal-nombre"></span>
    </div>
    <iframe id="reproductor" allowfullscreen></iframe>
</div>

<script>
    const PROXY = "https://api.allorigins.win/get?url=";
    const API_CANALES = "https://api.cdn-live.tv/api/v1/events/sports/?user=cdnlivetv&plan=free";

    const LIGAS_MAP = {
        soccer: [
            { id: 'esp.1', n: 'LaLiga EA Sports' }, { id: 'esp.2', n: 'LaLiga Hypermotion' },
            { id: 'eng.1', n: 'Premier League' }, { id: 'ger.1', n: 'Bundesliga' },
            { id: 'ita.1', n: 'Serie A' }, { id: 'fra.1', n: 'Ligue 1' },
            { id: 'uefa.champions', n: 'Champions League' }, { id: 'uefa.europa', n: 'Europa League' },
            { id: 'esp.copa_del_rey', n: 'Copa del Rey' }, { id: 'usa.1', n: 'MLS' },
            { id: 'mex.1', n: 'Liga MX' }, { id: 'arg.1', n: 'Liga Argentina' }
        ],
        basketball: [
            { id: 'nba', n: 'NBA' }, { id: 'esp.acb', n: 'Liga Endesa ACB' },
            { id: 'uefa.euroleague', n: 'Euroliga' }, { id: 'wnba', n: 'WNBA' },
            { id: 'mens-college-basketball', n: 'NCAA Basket' }
        ],
        tennis: [ { id: 'atp', n: 'ATP Tour' }, { id: 'wta', n: 'WTA Tour' } ],
        football: [ { id: 'nfl', n: 'NFL' }, { id: 'college-football', n: 'NCAA Football' } ],
        baseball: [ { id: 'mlb', n: 'MLB' } ],
        hockey: [ { id: 'nhl', n: 'NHL' } ]
    };

    let canalesData = [];
    let cacheEventos = [];

    async function cargarCanales() {
        const res = await fetch(PROXY + encodeURIComponent(API_CANALES));
        const json = await res.json();
        const data = JSON.parse(json.contents)['cdn-live-tv'];
        canalesData = [];
        Object.values(data).forEach(cat => { if(Array.isArray(cat)) canalesData.push(...cat); });
    }

    function cambiarDeporte() {
        const sport = document.getElementById('sport-selector').value;
        const selector = document.getElementById('league-selector');
        selector.innerHTML = LIGAS_MAP[sport].map(l => `<option value="${l.id}">${l.n}</option>`).join('');
        cargarLiga();
    }

    async function cargarLiga() {
        const sport = document.getElementById('sport-selector').value;
        const league = document.getElementById('league-selector').value;
        const list = document.getElementById('master-list');
        list.innerHTML = "Cargando programaci√≥n completa...";

        try {
            const res = await fetch(`https://site.api.espn.com/apis/site/v2/sports/${sport}/${league}/scoreboard`);
            const data = await res.json();
            cacheEventos = data.events || [];
            
            let html = `<div class="league-title">${document.getElementById('league-selector').selectedOptions[0].text}</div>`;
            
            cacheEventos.forEach(ev => {
                const comp = ev.competitions[0];
                const status = ev.status.type;
                html += `
                <div class="match-card" onclick="verEvento('${ev.id}')">
                    <div class="time-status">
                        ${status.state === 'in' ? '<span class="live-tag">üî¥ DIRECTO</span>' : status.shortDetail}
                    </div>
                    <div class="teams-grid">
                        <div class="team home"><span>${comp.competitors[0].team.shortDisplayName}</span> <img src="${comp.competitors[0].team.logo}"></div>
                        <div class="score-box">${comp.competitors[0].score} - ${comp.competitors[1].score}</div>
                        <div class="team away"><img src="${comp.competitors[1].team.logo}"> <span>${comp.competitors[1].team.shortDisplayName}</span></div>
                    </div>
                    <button class="dona-btn" style="background:var(--blue-accent); font-size:11px;">VER ANALISIS</button>
                </div>`;
            });
            list.innerHTML = html || "No hay eventos hoy para esta liga.";
        } catch(e) { list.innerHTML = "Error al cargar esta liga."; }
    }

    function verEvento(id) {
        const ev = cacheEventos.find(e => e.id === id);
        const comp = ev.competitions[0];
        
        // Buscar multienlaces
        const homeName = comp.competitors[0].team.displayName.toLowerCase();
        let links = [];
        canalesData.forEach(c => {
            if(homeName.includes(c.homeTeam.toLowerCase().split(' ')[0]) && c.channels) links.push(...c.channels);
        });

        document.getElementById('modal-body').innerHTML = `
            <button onclick="document.getElementById('detail-modal').style.display='none'" style="float:right">Cerrar</button>
            <h2 style="text-align:center">${ev.name}</h2>
            <p style="text-align:center">${ev.status.type.detail}</p>
            <div style="display:grid; grid-template-columns:1fr 1fr; gap:20px; margin:20px 0;">
                <div style="text-align:center; background:#f1f5f9; padding:15px; border-radius:10px;">
                    <h3>${comp.competitors[0].team.displayName}</h3>
                    <p>Probabilidad: ${Math.round(Math.random()*40 + 30)}%</p>
                </div>
                <div style="text-align:center; background:#f1f5f9; padding:15px; border-radius:10px;">
                    <h3>${comp.competitors[1].team.displayName}</h3>
                    <p>Probabilidad: ${Math.round(Math.random()*30)}%</p>
                </div>
            </div>
            <h3>üîó MULTIENLACES DISPONIBLES</h3>
            <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px;">
                ${links.length > 0 ? links.map(l => `
                    <button onclick="abrirCine('${l.url}', '${l.channel_name}')" style="padding:15px; background:var(--blue-espn); color:white; border-radius:5px; border:none; cursor:pointer; font-weight:bold;">üì∫ ${l.channel_name}</button>
                `).join('') : '<p>Se√±ales de TV disponibles al inicio del evento.</p>'}
            </div>
        `;
        document.getElementById('detail-modal').style.display = 'block';
    }

    function abrirCine(url, nombre) {
        document.getElementById('reproductor').src = url;
        document.getElementById('canal-nombre').innerText = nombre;
        document.getElementById('cine').style.display = 'flex';
    }

    function cerrarCine() {
        document.getElementById('cine').style.display = 'none';
        document.getElementById('reproductor').src = '';
    }

    cargarCanales();
    cambiarDeporte();
</script>
</body>
</html>
